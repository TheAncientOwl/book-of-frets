import{r as e}from"./react-C2u2R5M2.js";var t,i=Object.defineProperty,r=(e,t,r)=>((e,t,r)=>t in e?i(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r)(e,"symbol"!=typeof t?t+"":t,r),n=new Map,s=new WeakMap,o=0;function l(e){t=e}function c(e){return Object.keys(e).sort().filter(t=>void 0!==e[t]).map(t=>{return`${t}_${"root"===t?(i=e.root,i?(s.has(i)||(o+=1,s.set(i,o.toString())),s.get(i)):"0"):e[t]}`;var i}).toString()}function a(e,i,r={},s=t){if(void 0===window.IntersectionObserver&&void 0!==s){const t=e.getBoundingClientRect();return i(s,{isIntersecting:s,target:e,intersectionRatio:"number"==typeof r.threshold?r.threshold:0,time:0,boundingClientRect:t,intersectionRect:t,rootBounds:t}),()=>{}}const{id:o,observer:l,elements:a}=function(e){const t=c(e);let i=n.get(t);if(!i){const r=new Map;let s;const o=new IntersectionObserver(t=>{t.forEach(t=>{var i;const n=t.isIntersecting&&s.some(e=>t.intersectionRatio>=e);e.trackVisibility&&void 0===t.isVisible&&(t.isVisible=n),null==(i=r.get(t.target))||i.forEach(e=>{e(n,t)})})},e);s=o.thresholds||(Array.isArray(e.threshold)?e.threshold:[e.threshold||0]),i={id:t,observer:o,elements:r},n.set(t,i)}return i}(r),u=a.get(e)||[];return a.has(e)||a.set(e,u),u.push(i),l.observe(e),function(){u.splice(u.indexOf(i),1),0===u.length&&(a.delete(e),l.unobserve(e)),0===a.size&&(l.disconnect(),n.delete(o))}}var u,h,d=class extends e.Component{constructor(e){super(e),r(this,"node",null),r(this,"_unobserveCb",null),r(this,"lastInView"),r(this,"handleNode",e=>{this.node&&(this.unobserve(),e||this.props.triggerOnce||this.props.skip||(this.setState({inView:!!this.props.initialInView,entry:void 0}),this.lastInView=this.props.initialInView)),this.node=e||null,this.observeNode()}),r(this,"handleChange",(e,t)=>{const i=this.lastInView;this.lastInView=e,(void 0!==i||e)&&(e&&this.props.triggerOnce&&this.unobserve(),function(e){return"function"!=typeof e.children}(this.props)||this.setState({inView:e,entry:t}),this.props.onChange&&this.props.onChange(e,t))}),this.state={inView:!!e.initialInView,entry:void 0},this.lastInView=e.initialInView}componentDidMount(){this.unobserve(),this.observeNode()}componentDidUpdate(e){e.rootMargin===this.props.rootMargin&&e.root===this.props.root&&e.threshold===this.props.threshold&&e.skip===this.props.skip&&e.trackVisibility===this.props.trackVisibility&&e.delay===this.props.delay||(this.unobserve(),this.observeNode())}componentWillUnmount(){this.unobserve()}observeNode(){if(!this.node||this.props.skip)return;const{threshold:e,root:t,rootMargin:i,trackVisibility:r,delay:n,fallbackInView:s}=this.props;void 0===this.lastInView&&(this.lastInView=this.props.initialInView),this._unobserveCb=a(this.node,this.handleChange,{threshold:e,root:t,rootMargin:i,trackVisibility:r,delay:n},s)}unobserve(){this._unobserveCb&&(this._unobserveCb(),this._unobserveCb=null)}render(){const{children:t}=this.props;if("function"==typeof t){const{inView:e,entry:i}=this.state;return t({inView:e,entry:i,ref:this.handleNode})}const{as:i,triggerOnce:r,threshold:n,root:s,rootMargin:o,onChange:l,skip:c,trackVisibility:a,delay:u,initialInView:h,fallbackInView:d,...p}=this.props;return e.createElement(i||"div",{ref:this.handleNode,...p},t)}};function p({threshold:t,delay:i,trackVisibility:r,rootMargin:n,root:s,triggerOnce:o,skip:l,initialInView:c,fallbackInView:u,onChange:h}={}){var d;const[p,v]=e.useState(null),b=e.useRef(h),f=e.useRef(c),[g,y]=e.useState({inView:!!c,entry:void 0});b.current=h,e.useEffect(()=>{if(void 0===f.current&&(f.current=c),l||!p)return;let e;return e=a(p,(t,i)=>{const r=f.current;f.current=t,(void 0!==r||t)&&(y({inView:t,entry:i}),b.current&&b.current(t,i),i.isIntersecting&&o&&e&&(e(),e=void 0))},{root:s,rootMargin:n,threshold:t,trackVisibility:r,delay:i},u),()=>{e&&e()}},[Array.isArray(t)?t.toString():t,p,s,n,o,l,r,u,i]);const V=null==(d=g.entry)?void 0:d.target,w=e.useRef(void 0);p||!V||o||l||w.current===V||(w.current=V,y({inView:!!c,entry:void 0}),f.current=c);const k=[v,g.inView,g.entry];return k.ref=k[0],k.inView=k[1],k.entry=k[2],k}var v=null!=(h=null!=(u=e.useInsertionEffect)?u:e.useLayoutEffect)?h:e.useEffect,b=(t,{threshold:i,root:r,rootMargin:n,trackVisibility:s,delay:o,triggerOnce:l,skip:c}={})=>{const u=e.useRef(t),h=e.useRef(null),d=e.useRef(void 0),p=e.useRef(void 0);return v(()=>{u.current=t},[t]),e.useCallback(e=>{const t=()=>{if(d.current){const e=d.current;d.current=void 0,e()}};if(e===h.current)return d.current;if(!e||c)return t(),h.current=null,void(p.current=void 0);t(),h.current=e;let v=!1;const b=a(e,(e,t)=>{const i=p.current;p.current=e,(void 0!==i||e)&&(u.current(e,t),l&&e&&f())},{threshold:i,root:r,rootMargin:n,trackVisibility:s,delay:o});function f(){v||(v=!0,b(),h.current=null,d.current=void 0,p.current=void 0)}return d.current=f,d.current},[Array.isArray(i)?i.toString():i,r,n,s,o,l,c])};export{d as InView,l as defaultFallbackInView,a as observe,p as useInView,b as useOnInView};
