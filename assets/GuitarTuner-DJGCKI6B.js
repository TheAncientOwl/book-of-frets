import{j as h,I as Rt,B as dt,F as nt,R as pt,o as jt,t as zt,H as Mt,$ as qt,a0 as Dt,a1 as Et,w as Pt,a2 as kt,l as et,a3 as Vt}from"./chakra-CgcKltIF.js";import{g as $t,r as T}from"./react-CnHX3GmW.js";import{a as $,F as Nt,b as Wt,d as Gt,e as Ht,L as Ut}from"./index-DMFxoCN7.js";import"./react-virtualized-BkaSW4Fc.js";import"./react-icons-CUl3NLzO.js";var ft,_t;function Kt(){if(_t)return ft;_t=1;function o(r){if(this.size=r|0,this.size<=1||(this.size&this.size-1)!==0)throw new Error("FFT size must be a power of two and bigger than 1");this._csize=r<<1;for(var t=new Array(this.size*2),e=0;e<t.length;e+=2){const d=Math.PI*e/this.size;t[e]=Math.cos(d),t[e+1]=-Math.sin(d)}this.table=t;for(var s=0,n=1;this.size>n;n<<=1)s++;this._width=s%2===0?s-1:s,this._bitrev=new Array(1<<this._width);for(var a=0;a<this._bitrev.length;a++){this._bitrev[a]=0;for(var i=0;i<this._width;i+=2){var c=this._width-i-2;this._bitrev[a]|=(a>>>i&3)<<c}}this._out=null,this._data=null,this._inv=0}return ft=o,o.prototype.fromComplexArray=function(t,e){for(var s=e||new Array(t.length>>>1),n=0;n<t.length;n+=2)s[n>>>1]=t[n];return s},o.prototype.createComplexArray=function(){const t=new Array(this._csize);for(var e=0;e<t.length;e++)t[e]=0;return t},o.prototype.toComplexArray=function(t,e){for(var s=e||this.createComplexArray(),n=0;n<s.length;n+=2)s[n]=t[n>>>1],s[n+1]=0;return s},o.prototype.completeSpectrum=function(t){for(var e=this._csize,s=e>>>1,n=2;n<s;n+=2)t[e-n]=t[n],t[e-n+1]=-t[n+1]},o.prototype.transform=function(t,e){if(t===e)throw new Error("Input and output buffers must be different");this._out=t,this._data=e,this._inv=0,this._transform4(),this._out=null,this._data=null},o.prototype.realTransform=function(t,e){if(t===e)throw new Error("Input and output buffers must be different");this._out=t,this._data=e,this._inv=0,this._realTransform4(),this._out=null,this._data=null},o.prototype.inverseTransform=function(t,e){if(t===e)throw new Error("Input and output buffers must be different");this._out=t,this._data=e,this._inv=1,this._transform4();for(var s=0;s<t.length;s++)t[s]/=this.size;this._out=null,this._data=null},o.prototype._transform4=function(){var t=this._out,e=this._csize,s=this._width,n=1<<s,a=e/n<<1,i,c,d=this._bitrev;if(a===4)for(i=0,c=0;i<e;i+=a,c++){const u=d[c];this._singleTransform2(i,u,n)}else for(i=0,c=0;i<e;i+=a,c++){const u=d[c];this._singleTransform4(i,u,n)}var l=this._inv?-1:1,f=this.table;for(n>>=2;n>=2;n>>=2){a=e/n<<1;var g=a>>>2;for(i=0;i<e;i+=a)for(var b=i+g,x=i,_=0;x<b;x+=2,_+=n){const u=x,v=u+g,p=v+g,m=p+g,y=t[u],A=t[u+1],w=t[v],F=t[v+1],C=t[p],B=t[p+1],S=t[m],I=t[m+1],R=y,j=A,z=f[_],M=l*f[_+1],q=w*z-F*M,D=w*M+F*z,N=f[2*_],W=l*f[2*_+1],G=C*N-B*W,H=C*W+B*N,U=f[3*_],K=l*f[3*_+1],J=S*U-I*K,Q=S*K+I*U,X=R+G,E=j+H,P=R-G,Y=j-H,Z=q+J,k=D+Q,V=l*(q-J),L=l*(D-Q),rt=X+Z,st=E+k,ot=X-Z,it=E-k,at=P+L,ct=Y-V,lt=P-L,ut=Y+V;t[u]=rt,t[u+1]=st,t[v]=at,t[v+1]=ct,t[p]=ot,t[p+1]=it,t[m]=lt,t[m+1]=ut}}},o.prototype._singleTransform2=function(t,e,s){const n=this._out,a=this._data,i=a[e],c=a[e+1],d=a[e+s],l=a[e+s+1],f=i+d,g=c+l,b=i-d,x=c-l;n[t]=f,n[t+1]=g,n[t+2]=b,n[t+3]=x},o.prototype._singleTransform4=function(t,e,s){const n=this._out,a=this._data,i=this._inv?-1:1,c=s*2,d=s*3,l=a[e],f=a[e+1],g=a[e+s],b=a[e+s+1],x=a[e+c],_=a[e+c+1],u=a[e+d],v=a[e+d+1],p=l+x,m=f+_,y=l-x,A=f-_,w=g+u,F=b+v,C=i*(g-u),B=i*(b-v),S=p+w,I=m+F,R=y+B,j=A-C,z=p-w,M=m-F,q=y-B,D=A+C;n[t]=S,n[t+1]=I,n[t+2]=R,n[t+3]=j,n[t+4]=z,n[t+5]=M,n[t+6]=q,n[t+7]=D},o.prototype._realTransform4=function(){var t=this._out,e=this._csize,s=this._width,n=1<<s,a=e/n<<1,i,c,d=this._bitrev;if(a===4)for(i=0,c=0;i<e;i+=a,c++){const ht=d[c];this._singleRealTransform2(i,ht>>>1,n>>>1)}else for(i=0,c=0;i<e;i+=a,c++){const ht=d[c];this._singleRealTransform4(i,ht>>>1,n>>>1)}var l=this._inv?-1:1,f=this.table;for(n>>=2;n>=2;n>>=2){a=e/n<<1;var g=a>>>1,b=g>>>1,x=b>>>1;for(i=0;i<e;i+=a)for(var _=0,u=0;_<=x;_+=2,u+=n){var v=i+_,p=v+b,m=p+b,y=m+b,A=t[v],w=t[v+1],F=t[p],C=t[p+1],B=t[m],S=t[m+1],I=t[y],R=t[y+1],j=A,z=w,M=f[u],q=l*f[u+1],D=F*M-C*q,N=F*q+C*M,W=f[2*u],G=l*f[2*u+1],H=B*W-S*G,U=B*G+S*W,K=f[3*u],J=l*f[3*u+1],Q=I*K-R*J,X=I*J+R*K,E=j+H,P=z+U,Y=j-H,Z=z-U,k=D+Q,V=N+X,L=l*(D-Q),rt=l*(N-X),st=E+k,ot=P+V,it=Y+rt,at=Z-L;if(t[v]=st,t[v+1]=ot,t[p]=it,t[p+1]=at,_===0){var ct=E-k,lt=P-V;t[m]=ct,t[m+1]=lt;continue}if(_!==x){var ut=Y,bt=-Z,xt=E,yt=-P,Ft=-l*rt,Tt=-l*L,wt=-l*V,At=-l*k,Ct=ut+Ft,Bt=bt+Tt,St=xt+At,It=yt-wt,mt=i+b-_,vt=i+g-_;t[mt]=Ct,t[mt+1]=Bt,t[vt]=St,t[vt+1]=It}}}},o.prototype._singleRealTransform2=function(t,e,s){const n=this._out,a=this._data,i=a[e],c=a[e+s],d=i+c,l=i-c;n[t]=d,n[t+1]=0,n[t+2]=l,n[t+3]=0},o.prototype._singleRealTransform4=function(t,e,s){const n=this._out,a=this._data,i=this._inv?-1:1,c=s*2,d=s*3,l=a[e],f=a[e+s],g=a[e+c],b=a[e+d],x=l+g,_=l-g,u=f+b,v=i*(f-b),p=x+u,m=_,y=-v,A=x-u,w=_,F=v;n[t]=p,n[t+1]=0,n[t+2]=m,n[t+3]=y,n[t+4]=A,n[t+5]=0,n[t+6]=w,n[t+7]=F},ft}var Jt=Kt();const Qt=$t(Jt);class O{_inputLength;_fft;_bufferSupplier;_paddedInputBuffer;_transformBuffer;_inverseBuffer;static forFloat32Array(r){return new O(r,t=>new Float32Array(t))}static forFloat64Array(r){return new O(r,t=>new Float64Array(t))}static forNumberArray(r){return new O(r,t=>Array(t))}constructor(r,t){if(r<1)throw new Error("Input length must be at least one");this._inputLength=r,this._fft=new Qt(Zt(2*r)),this._bufferSupplier=t,this._paddedInputBuffer=this._bufferSupplier(this._fft.size),this._transformBuffer=this._bufferSupplier(2*this._fft.size),this._inverseBuffer=this._bufferSupplier(2*this._fft.size)}get inputLength(){return this._inputLength}autocorrelate(r,t=this._bufferSupplier(r.length)){if(r.length!==this._inputLength)throw new Error(`Input must have length ${this._inputLength} but had length ${r.length}`);for(let s=0;s<r.length;s++)this._paddedInputBuffer[s]=r[s];for(let s=r.length;s<this._paddedInputBuffer.length;s++)this._paddedInputBuffer[s]=0;this._fft.realTransform(this._transformBuffer,this._paddedInputBuffer),this._fft.completeSpectrum(this._transformBuffer);const e=this._transformBuffer;for(let s=0;s<e.length;s+=2)e[s]=e[s]*e[s]+e[s+1]*e[s+1],e[s+1]=0;this._fft.inverseTransform(this._inverseBuffer,this._transformBuffer);for(let s=0;s<r.length;s++)t[s]=this._inverseBuffer[2*s];return t}}function Xt(o){const r=[];let t=!1,e=-1/0,s=-1;for(let n=1;n<o.length-1;n++)o[n-1]<=0&&o[n]>0?(t=!0,s=n,e=o[n]):o[n-1]>0&&o[n]<=0?(t=!1,s!==-1&&r.push(s)):t&&o[n]>e&&(e=o[n],s=n);return r}function Yt(o,r){const[t,e,s]=[o-1,o,o+1],[n,a,i]=[r[t],r[e],r[s]],c=n/2-a+i/2,d=-(n/2)*(e+s)+a*(t+s)-i/2*(t+e),l=n*e*s/2-a*t*s+i*t*e/2,f=-d/(2*c),g=c*f*f+d*f+l;return[f,g]}class tt{_autocorrelator;_nsdfBuffer;_clarityThreshold=.9;_minVolumeAbsolute=0;_maxInputAmplitude=1;static forFloat32Array(r){return new tt(r,t=>new Float32Array(t))}static forFloat64Array(r){return new tt(r,t=>new Float64Array(t))}static forNumberArray(r){return new tt(r,t=>Array(t))}constructor(r,t){this._autocorrelator=new O(r,t),this._nsdfBuffer=t(r)}get inputLength(){return this._autocorrelator.inputLength}set clarityThreshold(r){if(!Number.isFinite(r)||r<=0||r>1)throw new Error("clarityThreshold must be a number in the range (0, 1]");this._clarityThreshold=r}set minVolumeAbsolute(r){if(!Number.isFinite(r)||r<0||r>this._maxInputAmplitude)throw new Error(`minVolumeAbsolute must be a number in the range [0, ${this._maxInputAmplitude}]`);this._minVolumeAbsolute=r}set minVolumeDecibels(r){if(!Number.isFinite(r)||r>0)throw new Error("minVolumeDecibels must be a number <= 0");this._minVolumeAbsolute=this._maxInputAmplitude*10**(r/10)}set maxInputAmplitude(r){if(!Number.isFinite(r)||r<=0)throw new Error("maxInputAmplitude must be a number > 0");this._maxInputAmplitude=r}findPitch(r,t){if(this._belowMinimumVolume(r))return[0,0];this._nsdf(r);const e=Xt(this._nsdfBuffer);if(e.length===0)return[0,0];const s=Math.max(...e.map(c=>this._nsdfBuffer[c])),n=e.find(c=>this._nsdfBuffer[c]>=this._clarityThreshold*s),[a,i]=Yt(n,this._nsdfBuffer);return[t/a,Math.min(i,1)]}_belowMinimumVolume(r){if(this._minVolumeAbsolute===0)return!1;let t=0;for(let e=0;e<r.length;e++)t+=r[e]**2;return Math.sqrt(t/r.length)<this._minVolumeAbsolute}_nsdf(r){this._autocorrelator.autocorrelate(r,this._nsdfBuffer);let t=2*this._nsdfBuffer[0],e;for(e=0;e<this._nsdfBuffer.length&&t>0;e++)this._nsdfBuffer[e]=2*this._nsdfBuffer[e]/t,t-=r[e]**2+r[r.length-e-1]**2;for(;e<this._nsdfBuffer.length;e++)this._nsdfBuffer[e]=0}}function Zt(o){return o--,o|=o>>1,o|=o>>2,o|=o>>4,o|=o>>8,o|=o>>16,o++,o}/**
 * -------------------------------------------------------------------------- *
 *                     Copyright (c) by OopsieLogsy 2025                      *
 * -------------------------------------------------------------------------- *
 * @license https://github.com/TheAncientOwl/oopsie-logsy/blob/main/LICENSE
 *
 * @file usePitchDetector.ts
 * @author Alexandru Delegeanu
 * @version 0.2
 * @description Pitch detector hook.
 */const Lt=(o,r)=>{let t=r[0],e=Math.abs(o-t.freq);for(const s of r){const n=Math.abs(o-s.freq);n<e&&(t=s,e=n)}return t.name},Ot=o=>{const[r,t]=T.useState("-"),[e,s]=T.useState(null),[n,a]=T.useState(!1),i=T.useRef(null),c=T.useRef(null),d=T.useRef(null),l=T.useRef(null),f=T.useRef(null),g=T.useRef(null),b=()=>{if(!i.current||!c.current||!d.current||!l.current)return;const u=c.current,v=d.current,p=l.current;u.getFloatTimeDomainData(p);const[m,y]=v.findPitch(p,i.current.sampleRate);m&&y>.9&&(s(m),t(Lt(m,o))),f.current=requestAnimationFrame(b)};return{note:r,frequency:e,isRunning:n,startTuner:async()=>{if(!n)try{const u=await navigator.mediaDevices.getUserMedia({audio:!0});g.current=u;const v=new AudioContext;i.current=v;const p=v.createMediaStreamSource(u),m=v.createAnalyser();m.fftSize=2048,c.current=m,p.connect(m);const y=tt.forFloat32Array(m.fftSize);d.current=y,l.current=new Float32Array(m.fftSize),a(!0),b()}catch(u){alert(`[!] Error accessing microphone: ${u}`),console.error("Error accessing microphone",u)}},stopTuner:()=>{n&&(f.current!==null&&cancelAnimationFrame(f.current),i.current?.close(),g.current?.getTracks().forEach(u=>u.stop()),f.current=null,i.current=null,g.current=null,c.current=null,d.current=null,l.current=null,a(!1),t("-"),s(null))}}},tr=o=>{const{appMenu:{items:{tuner:r}}}=$();return h.jsx(Rt,{"aria-label":"play-pause tuner",icon:o.isRunning?h.jsx(Nt,{}):h.jsx(Wt,{}),onClick:o.isRunning?o.onStop:o.onStart,mb:"10px",size:"lg",backgroundColor:r.controlButton.background,color:r.controlButton.color,_hover:{backgroundColor:r.controlButton.hover.background,color:r.controlButton.hover.color}})},rr=o=>{const{appMenu:{items:{tuner:r}}}=$();return h.jsx(dt,{...o.containerProps,fontWeight:"bold",color:r.frequencyDisplay.color,children:o.freq!==null?`(${o.freq?.toFixed(2)} Hz)`:"(0 Hz)"})},er=o=>{const{appMenu:{items:{tuner:r}}}=$(),t=o.targetFreq-o.currentFreq,e=Math.abs(t),s=e<=o.threshold,n=t>0,a=s?r.frequencyProgressIndicator.matched:n?r.frequencyProgressIndicator.tuneUp:r.frequencyProgressIndicator.tuneDown;return h.jsx(nt,{...o.containerProps,justifyContent:"center",children:h.jsx(pt,{size:"12",borderWidth:"thin",fontWeight:"bold",color:a.color,backgroundColor:a.background,borderColor:a.border,children:o.active?s?h.jsx(jt,{as:Gt}):`${n?"+":"-"}${e.toFixed(0)}`:"0"})})},nr=o=>{const{appMenu:{items:{tuner:r}}}=$();return h.jsxs(zt,{...o.containerProps,columns:[1,2],gap:"5px",children:[h.jsxs(Mt,{size:"sm",as:"h5",color:r.thresholdSlider.color,children:["Frequency Threshold",h.jsx("br",{})," ",o.threshold," Hz"]}),h.jsxs(qt,{value:o.threshold,onChange:t=>o.onThresholdChange(t),min:0,max:5,step:.1,children:[h.jsx(Dt,{backgroundColor:r.thresholdSlider.slider.track,children:h.jsx(Et,{backgroundColor:r.thresholdSlider.slider.filler})}),h.jsx(Pt,{label:`${o.threshold} Hz`,fontWeight:"bold",backgroundColor:r.thresholdSlider.slider.tooltip.background,color:r.thresholdSlider.slider.tooltip.color,children:h.jsx(kt,{backgroundColor:r.thresholdSlider.slider.thumb})})]})]})},sr=o=>{const{appMenu:{items:{tuner:r}}}=$(),t=o.active?r.strings.active:r.strings.inactive;return h.jsxs(nt,{direction:"column",alignItems:"center",justifyContent:"center",position:"relative",as:"button",onClick:o.onClick,children:[h.jsx(pt,{size:"10",fontWeight:"bold",borderWidth:"3px",color:t.noteColor,borderColor:t.noteBorderColor,backgroundColor:t.backgroundColor,children:o.name}),h.jsx(et,{orientation:"vertical",height:"125px",borderWidth:"2px",borderColor:t.stringColor})]})},or=["E","A","D","G","B","e"],ir=o=>h.jsx(nt,{...o.containerProps,direction:"row",gap:"10px",justifyContent:"center",children:or.map((r,t)=>h.jsx(sr,{name:r,active:r===o.activeString,onClick:()=>o.onStringClick(r)},t))}),gt=[{name:"E2",freq:82.41},{name:"A2",freq:110},{name:"D3",freq:146.83},{name:"G3",freq:196},{name:"B3",freq:246.94},{name:"E4",freq:329.63}],ar={E:0,A:1,D:2,G:3,B:4,e:5},dr=()=>{const o=Ot(gt),{appMenu:{items:{tuner:r}}}=$(),[t,e]=Ht(Ut.tunerThreshold,2),[s,n]=T.useState(null),a=()=>{o.startTuner(),n("E")},i=()=>{o.stopTuner(),n(null)};return h.jsxs(dt,{textAlign:"center",borderRadius:"5px",children:[h.jsx(et,{borderColor:r.divider}),h.jsxs(Vt,{gridTemplateColumns:["1fr 1fr"],alignItems:"center",padding:"0 2rem",children:[h.jsx(dt,{children:h.jsx(tr,{isRunning:o.isRunning,onStart:a,onStop:i})}),h.jsxs(nt,{direction:"column",padding:"1rem 0",children:[h.jsx(rr,{freq:o.frequency,containerProps:{mb:"0.7rem"}}),h.jsx(er,{active:s!==null&&o.isRunning,currentFreq:o.frequency||0,targetFreq:gt[ar[s||"E"]].freq,threshold:t,containerProps:{mb:"1rem"}})]})]}),h.jsx(et,{borderColor:r.divider,mb:"1rem"}),h.jsx(ir,{activeString:s,onStringClick:c=>n(c),containerProps:{mb:"1rem"}}),h.jsx(et,{borderColor:r.divider,mb:"1rem"}),h.jsx(nr,{threshold:t,onThresholdChange:e})]})};export{dr as GuitarTuner,dr as default};
